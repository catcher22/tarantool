box.show_injections()
---
 - error injections:
 - name: ERRINJ_TESTING
 - state: 0
 - name: ERRINJ_WAL_IO
 - state: 0
 - name: ERRINJ_WAL_ROTATE
 - state: 0
 - name: ERRINJ_INDEX_ALLOC
 - state: 0

...
box.set_injection('some-injection', 1)
---
 - fail: can't find error injection 'some-injection'
...
select * from t0 where k0 = 222444
No match
box.set_injection('ERRINJ_TESTING', 1)
---
...
select * from t0 where k0 = 222444
An error occurred: ER_INJECTION, 'Error injection 'ERRINJ_TESTING''
box.set_injection('ERRINJ_TESTING', 0)
---
...
box.set_injection('ERRINJ_WAL_IO', 1)
---
...
insert into t0 values (1)
An error occurred: ER_WAL_IO, 'Failed to write to disk'
select * from t0 where k0=1
No match
box.set_injection('ERRINJ_WAL_IO', 0)
---
...
insert into t0 values (1)
Insert OK, 1 row affected
box.set_injection('ERRINJ_WAL_IO', 1)
---
...
update t0 set k0=2 where k0=1
An error occurred: ER_WAL_IO, 'Failed to write to disk'
select * from t0 where k0=1
Found 1 tuple:
[1]
select * from t0 where k0=2
No match
box.set_injection('ERRINJ_WAL_IO', 0)
---
...
box.space[0]:truncate()
---
...
box.set_injection('ERRINJ_WAL_ROTATE', 1)
---
...
insert into t0 values (1)
An error occurred: ER_WAL_IO, 'Failed to write to disk'
select * from t0 where k0=1
No match
box.set_injection('ERRINJ_WAL_ROTATE', 0)
---
...
insert into t0 values (1)
Insert OK, 1 row affected
box.set_injection('ERRINJ_WAL_ROTATE', 1)
---
...
update t0 set k0=2 where k0=1
An error occurred: ER_WAL_IO, 'Failed to write to disk'
select * from t0 where k0=1
Found 1 tuple:
[1]
select * from t0 where k0=2
No match
box.set_injection('ERRINJ_WAL_ROTATE', 0)
---
...
update t0 set k0=2 where k0=1
Update OK, 1 row affected
select * from t0 where k0=1
No match
select * from t0 where k0=2
Found 1 tuple:
[2]
box.set_injection('ERRINJ_WAL_ROTATE', 1)
---
...
box.space[0]:truncate()
---
error: 'Failed to write to disk'
...
box.set_injection('ERRINJ_WAL_ROTATE', 0)
---
...
box.space[0]:truncate()
---
...
