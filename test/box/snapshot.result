
# Verify that the server starts from a pre-recorded snapshot.
# This way we check that the server can read old snapshots (v11)
# going forward.

#
# A test case for: http://bugs.launchpad.net/bugs/686411
# Check that 'save snapshot' does not overwrite a snapshot
# file that already exists. Verify also that any other
# error that happens when saving snapshot is propagated
# to the caller.

insert into t0 values (1, 'first tuple')
Insert OK, 1 row affected
save snapshot
---
ok
...
save snapshot
---
fail: can't save snapshot, errno 17 (File exists)
...
insert into t0 values (2, 'second tuple')
Insert OK, 1 row affected
# Make 'var' directory read-only.
save snapshot
---
fail: can't save snapshot, errno 13 (Permission denied)
...
delete from t0 where k0 = 1
Delete OK, 1 row affected
delete from t0 where k0 = 2
Delete OK, 1 row affected
#
# A test case for http://bugs.launchpad.net/bugs/727174
# "tarantool_box crashes when saving snapshot on SIGUSR1"
#

# Increment the lsn number, to make sure there is no such snapshot yet
#
insert into t0 values (1, 'Test tuple')
Insert OK, 1 row affected
Snapshot exists.
delete from t0 where k0=1
Delete OK, 1 row affected
